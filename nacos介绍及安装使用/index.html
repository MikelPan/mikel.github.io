<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Nacos介绍及安装使用 - 德国粗茶淡饭</title><meta name="Description" content="Nacos介绍及安装使用"><meta property="og:title" content="Nacos介绍及安装使用" />
<meta property="og:description" content="Nacos介绍及安装使用" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.mikel.pan/nacos%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/" />
<meta property="og:image" content="https://www.mikel.pan/logo.png"/>
<meta property="article:published_time" content="2021-02-04T17:42:02+08:00" />
<meta property="article:modified_time" content="2021-02-04T17:42:02+08:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://www.mikel.pan/logo.png"/>

<meta name="twitter:title" content="Nacos介绍及安装使用"/>
<meta name="twitter:description" content="Nacos介绍及安装使用"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://www.mikel.pan/nacos%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/" /><link rel="prev" href="https://www.mikel.pan/jenkins%E5%AE%89%E8%A3%85/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Nacos介绍及安装使用",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/www.mikel.pan\/nacos%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/www.mikel.pan\/images\/Apple-Devices-Preview.png",
                            "width":  3200 ,
                            "height":  2048 
                        }],"genre": "posts","keywords": "nacos","wordcount":  6712 ,
        "url": "https:\/\/www.mikel.pan\/nacos%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8\/","datePublished": "2021-02-04T17:42:02+08:00","dateModified": "2021-02-04T17:42:02+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/www.mikel.pan\/images\/avatar.png",
                    "width":  528 ,
                    "height":  560 
                }},"author": {
                "@type": "Person",
                "name": "MikelPan"
            },"description": "Nacos介绍及安装使用"
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="德国粗茶淡饭"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>德国粗茶淡饭</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/categories/documentation/"> 文档 </a><a class="menu-item" href="/about/"> 关于 </a><a class="menu-item" href="https://github.com/MikelPan/Cnblog.git" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item language" title="选择语言">简体中文<i class="fas fa-chevron-right fa-fw"></i>
                        <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/nacos%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/" selected>简体中文</option></select>
                    </a><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="德国粗茶淡饭"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>德国粗茶淡饭</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/categories/documentation/" title="">文档</a><a class="menu-item" href="/about/" title="">关于</a><a class="menu-item" href="https://github.com/MikelPan/Cnblog.git" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="选择语言">简体中文<i class="fas fa-chevron-right fa-fw"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/nacos%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/" selected>简体中文</option></select>
                </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Nacos介绍及安装使用</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>MikelPan</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"><i class="far fa-folder fa-fw"></i>中间件</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-02-04">2021-02-04</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 6712 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 14 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#什么是nacos">什么是Nacos</a>
      <ul>
        <li><a href="#nacos-概览">Nacos 概览</a></li>
        <li><a href="#nacos-功能">Nacos 功能</a></li>
        <li><a href="#nacos-架构">Nacos 架构</a>
          <ul>
            <li><a href="#服务-service">服务 (Service)</a></li>
            <li><a href="#服务注册中心-service-registry">服务注册中心 (Service Registry)</a></li>
            <li><a href="#服务元数据-service-metadata">服务元数据 (Service Metadata)</a></li>
            <li><a href="#服务提供方-service-provider">服务提供方 (Service Provider)</a></li>
            <li><a href="#服务消费方-service-consumer">服务消费方 (Service Consumer)</a></li>
            <li><a href="#配置-configuration">配置 (Configuration)</a></li>
            <li><a href="#配置管理-configuration-management">配置管理 (Configuration Management)</a></li>
            <li><a href="#名字服务-naming-service">名字服务 (Naming Service)</a></li>
            <li><a href="#配置服务-configuration-service">配置服务 (Configuration Service)</a></li>
            <li><a href="#逻辑架构及其组件">逻辑架构及其组件</a></li>
          </ul>
        </li>
        <li><a href="#nacos-部署">Nacos 部署</a>
          <ul>
            <li><a href="#集群部署架构图">集群部署架构图</a></li>
            <li><a href="#安装">安装</a></li>
            <li><a href="#初始化数据库">初始化数据库</a></li>
            <li><a href="#服务注册发现配置管理">服务注册&amp;发现配置管理</a></li>
          </ul>
        </li>
        <li><a href="#nacos-应用">Nacos 应用</a>
          <ul>
            <li><a href="#接入dubbo">接入dubbo</a></li>
            <li><a href="#provider-服务提供者">provider 服务提供者</a>
              <ul>
                <li><a href="#引入依赖">引入依赖</a></li>
                <li><a href="#修改配置文件">修改配置文件</a></li>
              </ul>
            </li>
            <li><a href="#consumer-消费者">consumer 消费者</a>
              <ul>
                <li><a href="#引入依赖-1">引入依赖</a></li>
                <li><a href="#修改配置文件-1">修改配置文件</a></li>
              </ul>
            </li>
            <li><a href="#测试">测试</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="什么是nacos">什么是Nacos</h2>
<h3 id="nacos-概览">Nacos 概览</h3>
<p>Nacos 致力于帮助您发现、配置和管理微服务。Nacos 提供了一组简单易用的特性集，帮助您快速实现动态服务发现、服务配置、服务元数据及流量管理。</p>
<p>Nacos 帮助您更敏捷和容易地构建、交付和管理微服务平台。 Nacos 是构建以“服务”为中心的现代应用架构 (例如微服务范式、云原生范式) 的服务基础设施。</p>
<h3 id="nacos-功能">Nacos 功能</h3>
<p>服务（Service）是 Nacos 世界的一等公民。Nacos 支持几乎所有主流类型的“服务”的发现、配置和管理：</p>
<p><a href="https://kubernetes.io/docs/concepts/services-networking/service/" target="_blank" rel="noopener noreffer">Kubernetes Service</a></p>
<p><a href="https://grpc.io/docs/guides/concepts.html#service-definition" target="_blank" rel="noopener noreffer">gRPC</a> &amp; <a href="https://dubbo.incubator.apache.org/" target="_blank" rel="noopener noreffer">Dubbo RPC Service</a></p>
<p><a href="https://spring.io/understanding/REST" target="_blank" rel="noopener noreffer">Spring Cloud RESTful Service</a></p>
<p>Nacos 的关键特性包括:</p>
<ul>
<li>服务发现和服务健康监测</li>
</ul>
<p>Nacos 支持基于 DNS 和基于 RPC 的服务发现。服务提供者使用 <a href="https://nacos.io/zh-cn/docs/sdk.html" target="_blank" rel="noopener noreffer">原生SDK</a>、<a href="https://nacos.io/zh-cn/docs/open-api.html" target="_blank" rel="noopener noreffer">OpenAPI</a>、或一个<a href="https://nacos.io/zh-cn/docs/other-language.html" target="_blank" rel="noopener noreffer">独立的Agent TODO</a>注册 Service 后，服务消费者可以使用<a href="https://nacos.io/zh-cn/docs/xx" target="_blank" rel="noopener noreffer">DNS TODO</a> 或<a href="https://nacos.io/zh-cn/docs/open-api.html" target="_blank" rel="noopener noreffer">HTTP&amp;API</a>查找和发现服务。</p>
<p>Nacos 提供对服务的实时的健康检查，阻止向不健康的主机或服务实例发送请求。Nacos 支持传输层 (PING 或 TCP)和应用层 (如 HTTP、MySQL、用户自定义）的健康检查。 对于复杂的云环境和网络拓扑环境中（如 VPC、边缘网络等）服务的健康检查，Nacos 提供了 agent 上报模式和服务端主动检测2种健康检查模式。Nacos 还提供了统一的健康检查仪表盘，帮助您根据健康状态管理服务的可用性及流量。</p>
<ul>
<li>动态配置服务</li>
</ul>
<p>动态配置服务可以让您以中心化、外部化和动态化的方式管理所有环境的应用配置和服务配置。</p>
<p>动态配置消除了配置变更时重新部署应用和服务的需要，让配置管理变得更加高效和敏捷。</p>
<p>配置中心化管理让实现无状态服务变得更简单，让服务按需弹性扩展变得更容易。</p>
<p>Nacos 提供了一个简洁易用的UI (<a href="http://console.nacos.io/nacos/index.html" target="_blank" rel="noopener noreffer">控制台样例 Demo</a>) 帮助您管理所有的服务和应用的配置。Nacos 还提供包括配置版本跟踪、金丝雀发布、一键回滚配置以及客户端配置更新状态跟踪在内的一系列开箱即用的配置管理特性，帮助您更安全地在生产环境中管理配置变更和降低配置变更带来的风险。</p>
<ul>
<li>动态DNS服务</li>
</ul>
<p>动态 DNS 服务支持权重路由，让您更容易地实现中间层负载均衡、更灵活的路由策略、流量控制以及数据中心内网的简单DNS解析服务。动态DNS服务还能让您更容易地实现以 DNS 协议为基础的服务发现，以帮助您消除耦合到厂商私有服务发现 API 上的风险。</p>
<p>Nacos 提供了一些简单的 <a href="https://nacos.io/zh-cn/docs/xx" target="_blank" rel="noopener noreffer">DNS APIs TODO</a> 帮助您管理服务的关联域名和可用的 IP:PORT 列表.</p>
<ul>
<li>服务及其元数据管理</li>
</ul>
<p>Nacos 能让您从微服务平台建设的视角管理数据中心的所有服务及元数据，包括管理服务的描述、生命周期、服务的静态依赖分析、服务的健康状态、服务的流量管理、路由及安全策略、服务的 SLA 以及最首要的 metrics 统计数据。</p>
<h3 id="nacos-架构">Nacos 架构</h3>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://i.loli.net/2021/01/29/zNyYWm2aFhA8fqe.png"
        data-srcset="https://i.loli.net/2021/01/29/zNyYWm2aFhA8fqe.png, https://i.loli.net/2021/01/29/zNyYWm2aFhA8fqe.png 1.5x, https://i.loli.net/2021/01/29/zNyYWm2aFhA8fqe.png 2x"
        data-sizes="auto"
        alt="https://i.loli.net/2021/01/29/zNyYWm2aFhA8fqe.png"
        title="nacos-jg.png" /></p>
<h4 id="服务-service">服务 (Service)</h4>
<p>服务是指一个或一组软件功能（例如特定信息的检索或一组操作的执行），其目的是不同的客户端可以为不同的目的重用（例如通过跨进程的网络调用）。Nacos 支持主流的服务生态，如 Kubernetes Service、gRPC|Dubbo RPC Service 或者 Spring Cloud RESTful Service.</p>
<h4 id="服务注册中心-service-registry">服务注册中心 (Service Registry)</h4>
<p>服务注册中心，它是服务，其实例及元数据的数据库。服务实例在启动时注册到服务注册表，并在关闭时注销。服务和路由器的客户端查询服务注册表以查找服务的可用实例。服务注册中心可能会调用服务实例的健康检查 API 来验证它是否能够处理请求。</p>
<h4 id="服务元数据-service-metadata">服务元数据 (Service Metadata)</h4>
<p>服务元数据是指包括服务端点(endpoints)、服务标签、服务版本号、服务实例权重、路由规则、安全策略等描述服务的数据</p>
<h4 id="服务提供方-service-provider">服务提供方 (Service Provider)</h4>
<p>是指提供可复用和可调用服务的应用方</p>
<h4 id="服务消费方-service-consumer">服务消费方 (Service Consumer)</h4>
<p>是指会发起对某个服务调用的应用方</p>
<h4 id="配置-configuration">配置 (Configuration)</h4>
<p>在系统开发过程中通常会将一些需要变更的参数、变量等从代码中分离出来独立管理，以独立的配置文件的形式存在。目的是让静态的系统工件或者交付物（如 WAR，JAR 包等）更好地和实际的物理运行环境进行适配。配置管理一般包含在系统部署的过程中，由系统管理员或者运维人员完成这个步骤。配置变更是调整系统运行时的行为的有效手段之一。</p>
<h4 id="配置管理-configuration-management">配置管理 (Configuration Management)</h4>
<p>在数据中心中，系统中所有配置的编辑、存储、分发、变更管理、历史版本管理、变更审计等所有与配置相关的活动统称为配置管理。</p>
<h4 id="名字服务-naming-service">名字服务 (Naming Service)</h4>
<p>提供分布式系统中所有对象(Object)、实体(Entity)的“名字”到关联的元数据之间的映射管理服务，例如 ServiceName -&gt; Endpoints Info, Distributed Lock Name -&gt; Lock Owner/Status Info, DNS Domain Name -&gt; IP List, 服务发现和 DNS 就是名字服务的2大场景。</p>
<h4 id="配置服务-configuration-service">配置服务 (Configuration Service)</h4>
<p>在服务或者应用运行过程中，提供动态配置或者元数据以及配置管理的服务提供者。</p>
<h4 id="逻辑架构及其组件">逻辑架构及其组件</h4>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://i.loli.net/2021/01/29/4meANh7s2EuYIkL.png"
        data-srcset="https://i.loli.net/2021/01/29/4meANh7s2EuYIkL.png, https://i.loli.net/2021/01/29/4meANh7s2EuYIkL.png 1.5x, https://i.loli.net/2021/01/29/4meANh7s2EuYIkL.png 2x"
        data-sizes="auto"
        alt="https://i.loli.net/2021/01/29/4meANh7s2EuYIkL.png"
        title="nacos-ljjg.png" /></p>
<ul>
<li>服务管理：实现服务CRUD，域名CRUD，服务健康状态检查，服务权重管理等功能</li>
<li>配置管理：实现配置管CRUD，版本管理，灰度管理，监听管理，推送轨迹，聚合数据等功能</li>
<li>元数据管理：提供元数据CURD 和打标能力</li>
<li>插件机制：实现三个模块可分可合能力，实现扩展点SPI机制</li>
<li>事件机制：实现异步化事件通知，sdk数据变化异步通知等逻辑</li>
<li>日志模块：管理日志分类，日志级别，日志可移植性（尤其避免冲突），日志格式，异常码+帮助文档</li>
<li>回调机制：sdk通知数据，通过统一的模式回调用户处理。接口和数据结构需要具备可扩展性</li>
<li>寻址模式：解决ip，域名，nameserver、广播等多种寻址模式，需要可扩展</li>
<li>推送通道：解决server与存储、server间、server与sdk间推送性能问题</li>
<li>容量管理：管理每个租户，分组下的容量，防止存储被写爆，影响服务可用性</li>
<li>流量管理：按照租户，分组等多个维度对请求频率，长链接个数，报文大小，请求流控进行控制</li>
<li>缓存机制：容灾目录，本地缓存，server缓存机制。容灾目录使用需要工具</li>
<li>启动模式：按照单机模式，配置模式，服务模式，dns模式，或者all模式，启动不同的程序+UI</li>
<li>一致性协议：解决不同数据，不同一致性要求情况下，不同一致性机制</li>
<li>存储模块：解决数据持久化、非持久化存储，解决数据分片问题</li>
<li>Nameserver：解决namespace到clusterid的路由问题，解决用户环境与nacos物理环境映射问题</li>
<li>CMDB：解决元数据存储，与三方cmdb系统对接问题，解决应用，人，资源关系</li>
<li>Metrics：暴露标准metrics数据，方便与三方监控系统打通</li>
<li>Trace：暴露标准trace，方便与SLA系统打通，日志白平化，推送轨迹等能力，并且可以和计量计费系统打通</li>
<li>接入管理：相当于阿里云开通服务，分配身份、容量、权限过程</li>
<li>用户管理：解决用户管理，登录，sso等问题</li>
<li>权限管理：解决身份识别，访问控制，角色管理等问题</li>
<li>审计系统：扩展接口方便与不同公司审计系统打通</li>
<li>通知系统：核心数据变更，或者操作，方便通过SMS系统打通，通知到对应人数据变更</li>
<li>OpenAPI：暴露标准Rest风格HTTP接口，简单易用，方便多语言集成</li>
<li>Console：易用控制台，做服务管理、配置管理等操作</li>
<li>SDK：多语言sdk</li>
<li>Agent：dns-f类似模式，或者与mesh等方案集成</li>
<li>CLI：命令行对产品进行轻量化管理，像git一样好用</li>
</ul>
<h3 id="nacos-部署">Nacos 部署</h3>
<h4 id="集群部署架构图">集群部署架构图</h4>
<p><a href="http://ip1/" target="_blank" rel="noopener noreffer">http://ip1</a>:port/openAPI 直连ip模式，机器挂则需要修改ip才可以使用。</p>
<p><a href="http://vip/" target="_blank" rel="noopener noreffer">http://VIP</a>:port/openAPI 挂载VIP模式，直连vip即可，下面挂server真实ip，可读性不好。</p>
<p><a href="http://nacos.com/" target="_blank" rel="noopener noreffer">http://nacos.com</a>:port/openAPI 域名 + VIP模式，可读性好，而且换ip方便，推荐模式</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://i.loli.net/2021/01/29/MHrS692meuxVl4k.png"
        data-srcset="https://i.loli.net/2021/01/29/MHrS692meuxVl4k.png, https://i.loli.net/2021/01/29/MHrS692meuxVl4k.png 1.5x, https://i.loli.net/2021/01/29/MHrS692meuxVl4k.png 2x"
        data-sizes="auto"
        alt="https://i.loli.net/2021/01/29/MHrS692meuxVl4k.png"
        title="nacos-deploy.png" /></p>
<h4 id="安装">安装</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># helm repo 下载</span>
helm pull aliyuncs/nacos
<span class="c1"># 配置values </span>
<span class="c1">## 修改模式为集群模式</span>
global:
 <span class="c1">#mode: quickstart</span>
 <span class="c1">#mode: standalone</span>
 mode: cluster 
<span class="c1">## 添加sc提供数据存储</span>
persistence:
    enabled: <span class="nb">false</span>
    existingClaim: mysql-slave-data
    <span class="c1">#existingClaim:</span>
    claim: 
      name: mysql-slave-data
      spec: 
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 5G
        storageClassName: sc-mysql-slave
<span class="c1">## 修改副本数</span>
replicaCount: <span class="m">3</span>
<span class="c1">## 利用阿里云nas动态卷创建sc</span>
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  annotations:
    meta.helm.sh/release-name: nacos
    meta.helm.sh/release-namespace: middleware
  labels:
    app.kubernetes.io/managed-by: Helm
  name: alibabacloud-nas-nacos
mountOptions:
- nolock,tcp,noresvport
- <span class="nv">vers</span><span class="o">=</span><span class="m">3</span>
parameters:
  server: nas_server:/nacos/
  volumeAs: subpath
provisioner: nasplugin.csi.alibabacloud.com
reclaimPolicy: Delete
volumeBindingMode: Immediate
<span class="c1"># 配置mysql数据源</span>
<span class="c1">## mysql 高可用集群，db.num配置为1</span>
ng
server.servlet.contextPath<span class="o">=</span><span class="si">${</span><span class="nv">SERVER_SERVLET_CONTEXTPATH</span><span class="p">:/nacos</span><span class="si">}</span>
server.contextPath<span class="o">=</span>/nacos
server.port<span class="o">=</span><span class="si">${</span><span class="nv">NACOS_APPLICATION_PORT</span><span class="p">:</span><span class="nv">8848</span><span class="si">}</span>
spring.datasource.platform<span class="o">=</span><span class="si">${</span><span class="nv">SPRING_DATASOURCE_PLATFORM</span><span class="p">:</span><span class="s2">&#34;&#34;</span><span class="si">}</span>
nacos.cmdb.dumpTaskInterval<span class="o">=</span><span class="m">3600</span>
nacos.cmdb.eventTaskInterval<span class="o">=</span><span class="m">10</span>
nacos.cmdb.labelTaskInterval<span class="o">=</span><span class="m">300</span>
nacos.cmdb.loadDataAtStart<span class="o">=</span><span class="nb">false</span>
db.num<span class="o">=</span><span class="si">${</span><span class="nv">MYSQL_DATABASE_NUM</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span>
db.url.0<span class="o">=</span>jdbc:mysql://<span class="si">${</span><span class="nv">MYSQL_SERVICE_HOST</span><span class="si">}</span>:<span class="si">${</span><span class="nv">MYSQL_SERVICE_PORT</span><span class="p">:</span><span class="nv">3306</span><span class="si">}</span>/<span class="si">${</span><span class="nv">MYSQL_SERVICE_DB_NAME</span><span class="si">}</span>?<span class="si">${</span><span class="nv">MYSQL_SERVICE_DB_PARAM</span><span class="p">:</span><span class="nv">characterEncoding</span><span class="p">=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true</span><span class="si">}</span>
db.url.1<span class="o">=</span>jdbc:mysql://<span class="si">${</span><span class="nv">MYSQL_SERVICE_HOST</span><span class="si">}</span>:<span class="si">${</span><span class="nv">MYSQL_SERVICE_PORT</span><span class="p">:</span><span class="nv">3306</span><span class="si">}</span>/<span class="si">${</span><span class="nv">MYSQL_SERVICE_DB_NAME</span><span class="si">}</span>?<span class="si">${</span><span class="nv">MYSQL_SERVICE_DB_PARAM</span><span class="p">:</span><span class="nv">characterEncoding</span><span class="p">=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true</span><span class="si">}</span>
db.user<span class="o">=</span><span class="si">${</span><span class="nv">MYSQL_SERVICE_USER</span><span class="si">}</span>
db.password<span class="o">=</span><span class="si">${</span><span class="nv">MYSQL_SERVICE_PASSWORD</span><span class="si">}</span>
<span class="c1"># 安装</span>
helm upgrade --install nacos aliyun/nacos -n ddyw-mmeber-test --debug
</code></pre></td></tr></table>
</div>
</div><h4 id="初始化数据库">初始化数据库</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="cm">/*
</span><span class="cm"> * Copyright 1999-2018 Alibaba Group Holding Ltd.
</span><span class="cm"> *
</span><span class="cm"> * Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span><span class="cm"> * you may not use this file except in compliance with the License.
</span><span class="cm"> * You may obtain a copy of the License at
</span><span class="cm"> *
</span><span class="cm"> *      http://www.apache.org/licenses/LICENSE-2.0
</span><span class="cm"> *
</span><span class="cm"> * Unless required by applicable law or agreed to in writing, software
</span><span class="cm"> * distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
</span><span class="cm"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span><span class="cm"> * See the License for the specific language governing permissions and
</span><span class="cm"> * limitations under the License.
</span><span class="cm"> */</span>

<span class="cm">/******************************************/</span>
<span class="cm">/*   数据库全名 = nacos_config   */</span>
<span class="cm">/*   表名称 = config_info   */</span>
<span class="cm">/******************************************/</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">config_info</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="k">COMMENT</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">data_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;data_id&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">group_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">content</span><span class="o">`</span> <span class="n">longtext</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;content&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">md5</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;md5&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">gmt_create</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">COMMENT</span> <span class="s1">&#39;创建时间&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">gmt_modified</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">COMMENT</span> <span class="s1">&#39;修改时间&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">src_user</span><span class="o">`</span> <span class="nb">text</span> <span class="k">COMMENT</span> <span class="s1">&#39;source user&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">src_ip</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;source ip&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">app_name</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">tenant_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;租户字段&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">c_desc</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">c_use</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">effect</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="k">type</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">c_schema</span><span class="o">`</span> <span class="nb">text</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span>
  <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="o">`</span><span class="n">uk_configinfo_datagrouptenant</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">data_id</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">group_id</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">tenant_id</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_bin</span> <span class="k">COMMENT</span><span class="o">=</span><span class="s1">&#39;config_info&#39;</span><span class="p">;</span>

<span class="cm">/******************************************/</span>
<span class="cm">/*   数据库全名 = nacos_config   */</span>
<span class="cm">/*   表名称 = config_info_aggr   */</span>
<span class="cm">/******************************************/</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">config_info_aggr</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="k">COMMENT</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">data_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;data_id&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">group_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;group_id&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">datum_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;datum_id&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">content</span><span class="o">`</span> <span class="n">longtext</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;内容&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">gmt_modified</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;修改时间&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">app_name</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">tenant_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;租户字段&#39;</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span>
  <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="o">`</span><span class="n">uk_configinfoaggr_datagrouptenantdatum</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">data_id</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">group_id</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">tenant_id</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">datum_id</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_bin</span> <span class="k">COMMENT</span><span class="o">=</span><span class="s1">&#39;增加租户字段&#39;</span><span class="p">;</span>


<span class="cm">/******************************************/</span>
<span class="cm">/*   数据库全名 = nacos_config   */</span>
<span class="cm">/*   表名称 = config_info_beta   */</span>
<span class="cm">/******************************************/</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">config_info_beta</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="k">COMMENT</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">data_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;data_id&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">group_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;group_id&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">app_name</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;app_name&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">content</span><span class="o">`</span> <span class="n">longtext</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;content&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">beta_ips</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;betaIps&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">md5</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;md5&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">gmt_create</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">COMMENT</span> <span class="s1">&#39;创建时间&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">gmt_modified</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">COMMENT</span> <span class="s1">&#39;修改时间&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">src_user</span><span class="o">`</span> <span class="nb">text</span> <span class="k">COMMENT</span> <span class="s1">&#39;source user&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">src_ip</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;source ip&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">tenant_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;租户字段&#39;</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span>
  <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="o">`</span><span class="n">uk_configinfobeta_datagrouptenant</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">data_id</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">group_id</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">tenant_id</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_bin</span> <span class="k">COMMENT</span><span class="o">=</span><span class="s1">&#39;config_info_beta&#39;</span><span class="p">;</span>

<span class="cm">/******************************************/</span>
<span class="cm">/*   数据库全名 = nacos_config   */</span>
<span class="cm">/*   表名称 = config_info_tag   */</span>
<span class="cm">/******************************************/</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">config_info_tag</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="k">COMMENT</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">data_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;data_id&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">group_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;group_id&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">tenant_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;tenant_id&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">tag_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;tag_id&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">app_name</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;app_name&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">content</span><span class="o">`</span> <span class="n">longtext</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;content&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">md5</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;md5&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">gmt_create</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">COMMENT</span> <span class="s1">&#39;创建时间&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">gmt_modified</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">COMMENT</span> <span class="s1">&#39;修改时间&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">src_user</span><span class="o">`</span> <span class="nb">text</span> <span class="k">COMMENT</span> <span class="s1">&#39;source user&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">src_ip</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;source ip&#39;</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span>
  <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="o">`</span><span class="n">uk_configinfotag_datagrouptenanttag</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">data_id</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">group_id</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">tenant_id</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">tag_id</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_bin</span> <span class="k">COMMENT</span><span class="o">=</span><span class="s1">&#39;config_info_tag&#39;</span><span class="p">;</span>

<span class="cm">/******************************************/</span>
<span class="cm">/*   数据库全名 = nacos_config   */</span>
<span class="cm">/*   表名称 = config_tags_relation   */</span>
<span class="cm">/******************************************/</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">config_tags_relation</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">tag_name</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;tag_name&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">tag_type</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;tag_type&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">data_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;data_id&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">group_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;group_id&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">tenant_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;tenant_id&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">nid</span><span class="o">`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">nid</span><span class="o">`</span><span class="p">),</span>
  <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="o">`</span><span class="n">uk_configtagrelation_configidtag</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">tag_name</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">tag_type</span><span class="o">`</span><span class="p">),</span>
  <span class="k">KEY</span> <span class="o">`</span><span class="n">idx_tenant_id</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">tenant_id</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_bin</span> <span class="k">COMMENT</span><span class="o">=</span><span class="s1">&#39;config_tag_relation&#39;</span><span class="p">;</span>

<span class="cm">/******************************************/</span>
<span class="cm">/*   数据库全名 = nacos_config   */</span>
<span class="cm">/*   表名称 = group_capacity   */</span>
<span class="cm">/******************************************/</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">group_capacity</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="k">COMMENT</span> <span class="s1">&#39;主键ID&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">group_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;Group ID，空字符表示整个集群&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">quota</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">&#39;0&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;配额，0表示使用默认值&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="k">usage</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">&#39;0&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;使用量&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">max_size</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">&#39;0&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;单个配置大小上限，单位为字节，0表示使用默认值&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">max_aggr_count</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">&#39;0&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;聚合子配置最大个数，，0表示使用默认值&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">max_aggr_size</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">&#39;0&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">max_history_count</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">&#39;0&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;最大变更历史数量&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">gmt_create</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">COMMENT</span> <span class="s1">&#39;创建时间&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">gmt_modified</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">COMMENT</span> <span class="s1">&#39;修改时间&#39;</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span>
  <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="o">`</span><span class="n">uk_group_id</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">group_id</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_bin</span> <span class="k">COMMENT</span><span class="o">=</span><span class="s1">&#39;集群、各Group容量信息表&#39;</span><span class="p">;</span>

<span class="cm">/******************************************/</span>
<span class="cm">/*   数据库全名 = nacos_config   */</span>
<span class="cm">/*   表名称 = his_config_info   */</span>
<span class="cm">/******************************************/</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">his_config_info</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">nid</span><span class="o">`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="n">data_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">group_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">app_name</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;app_name&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">content</span><span class="o">`</span> <span class="n">longtext</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">md5</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">gmt_create</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
  <span class="o">`</span><span class="n">gmt_modified</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
  <span class="o">`</span><span class="n">src_user</span><span class="o">`</span> <span class="nb">text</span><span class="p">,</span>
  <span class="o">`</span><span class="n">src_ip</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">op_type</span><span class="o">`</span> <span class="nb">char</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">tenant_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;租户字段&#39;</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">nid</span><span class="o">`</span><span class="p">),</span>
  <span class="k">KEY</span> <span class="o">`</span><span class="n">idx_gmt_create</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">gmt_create</span><span class="o">`</span><span class="p">),</span>
  <span class="k">KEY</span> <span class="o">`</span><span class="n">idx_gmt_modified</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">gmt_modified</span><span class="o">`</span><span class="p">),</span>
  <span class="k">KEY</span> <span class="o">`</span><span class="n">idx_did</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">data_id</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_bin</span> <span class="k">COMMENT</span><span class="o">=</span><span class="s1">&#39;多租户改造&#39;</span><span class="p">;</span>


<span class="cm">/******************************************/</span>
<span class="cm">/*   数据库全名 = nacos_config   */</span>
<span class="cm">/*   表名称 = tenant_capacity   */</span>
<span class="cm">/******************************************/</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">tenant_capacity</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="k">COMMENT</span> <span class="s1">&#39;主键ID&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">tenant_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">&#39;&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;Tenant ID&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">quota</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">&#39;0&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;配额，0表示使用默认值&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="k">usage</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">&#39;0&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;使用量&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">max_size</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">&#39;0&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;单个配置大小上限，单位为字节，0表示使用默认值&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">max_aggr_count</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">&#39;0&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;聚合子配置最大个数&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">max_aggr_size</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">&#39;0&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">max_history_count</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">&#39;0&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;最大变更历史数量&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">gmt_create</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">COMMENT</span> <span class="s1">&#39;创建时间&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">gmt_modified</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">COMMENT</span> <span class="s1">&#39;修改时间&#39;</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span>
  <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="o">`</span><span class="n">uk_tenant_id</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">tenant_id</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_bin</span> <span class="k">COMMENT</span><span class="o">=</span><span class="s1">&#39;租户容量信息表&#39;</span><span class="p">;</span>


<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">tenant_info</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="k">COMMENT</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">kp</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;kp&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">tenant_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">default</span> <span class="s1">&#39;&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;tenant_id&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">tenant_name</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">default</span> <span class="s1">&#39;&#39;</span> <span class="k">COMMENT</span> <span class="s1">&#39;tenant_name&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">tenant_desc</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;tenant_desc&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">create_source</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;create_source&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">gmt_create</span><span class="o">`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;创建时间&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">gmt_modified</span><span class="o">`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;修改时间&#39;</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span>
  <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="o">`</span><span class="n">uk_tenant_info_kptenantid</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">kp</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">tenant_id</span><span class="o">`</span><span class="p">),</span>
  <span class="k">KEY</span> <span class="o">`</span><span class="n">idx_tenant_id</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">tenant_id</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_bin</span> <span class="k">COMMENT</span><span class="o">=</span><span class="s1">&#39;tenant_info&#39;</span><span class="p">;</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">users</span><span class="o">`</span> <span class="p">(</span>
	<span class="o">`</span><span class="n">username</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
	<span class="o">`</span><span class="n">password</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="o">`</span><span class="n">enabled</span><span class="o">`</span> <span class="nb">boolean</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">roles</span><span class="o">`</span> <span class="p">(</span>
	<span class="o">`</span><span class="n">username</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="o">`</span><span class="k">role</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="k">UNIQUE</span> <span class="k">INDEX</span> <span class="o">`</span><span class="n">idx_user_role</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">username</span><span class="o">`</span> <span class="k">ASC</span><span class="p">,</span> <span class="o">`</span><span class="k">role</span><span class="o">`</span> <span class="k">ASC</span><span class="p">)</span> <span class="k">USING</span> <span class="n">BTREE</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">permissions</span><span class="o">`</span> <span class="p">(</span>
    <span class="o">`</span><span class="k">role</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="o">`</span><span class="n">resource</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="o">`</span><span class="n">action</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">UNIQUE</span> <span class="k">INDEX</span> <span class="o">`</span><span class="n">uk_role_permission</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="k">role</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">resource</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">action</span><span class="o">`</span><span class="p">)</span> <span class="k">USING</span> <span class="n">BTREE</span>
<span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">users</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">enabled</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;nacos&#39;</span><span class="p">,</span> <span class="s1">&#39;$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu&#39;</span><span class="p">,</span> <span class="k">TRUE</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">roles</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="k">role</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;nacos&#39;</span><span class="p">,</span> <span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="服务注册发现配置管理">服务注册&amp;发现配置管理</h4>
<p><strong>服务注册</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 注册服务</span>
curl -X PUT <span class="s1">&#39;http://127.0.0.1:8848/nacos/v1/ns/instance？serviceName=nacos.naming.serviceName&amp;ip=20.18.7.10&amp;port=8080&#39;</span>
返回：ok
</code></pre></td></tr></table>
</div>
</div><p><strong>服务发现</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 查询服务</span>
curl -X GET <span class="s1">&#39;http://127.0.0.1:8848/nacos/v1/ns/instance/list?serviceName=nacos.naming.serviceName&#39;</span>
<span class="o">{</span><span class="s2">&#34;dom&#34;</span>:<span class="s2">&#34;nacos.naming.serviceName&#34;</span>,<span class="s2">&#34;name&#34;</span>:<span class="s2">&#34;DEFAULT_GROUP@@nacos.naming.serviceName&#34;</span>,<span class="s2">&#34;cacheMillis&#34;</span>:3000,<span class="s2">&#34;lastRefTime&#34;</span>:1611892884808,<span class="s2">&#34;checksum&#34;</span>:<span class="s2">&#34;7f882d81002bc22181203d423a20a16d&#34;</span>,<span class="s2">&#34;useSpecifiedURL&#34;</span>:false,<span class="s2">&#34;clusters&#34;</span>:<span class="s2">&#34;&#34;</span>,<span class="s2">&#34;env&#34;</span>:<span class="s2">&#34;&#34;</span>,<span class="s2">&#34;hosts&#34;</span>:<span class="o">[]</span>,<span class="s2">&#34;metadata&#34;</span>:<span class="o">{}}</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>发布配置</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 发布配置</span>
curl -X POST <span class="s2">&#34;http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=nacos.cfg.dataId&amp;group=test&amp;content=helloWorld&#34;</span>
返回：true
</code></pre></td></tr></table>
</div>
</div><p><strong>获取配置</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 获取配置</span>
curl -X GET <span class="s2">&#34;http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=nacos.cfg.dataId&amp;group=test&#34;</span>
返回：helloWorld
</code></pre></td></tr></table>
</div>
</div><h3 id="nacos-应用">Nacos 应用</h3>
<h4 id="接入dubbo">接入dubbo</h4>
<p>项目结构如下：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://i.loli.net/2021/01/29/HigjtbC35yLIAY7.png"
        data-srcset="https://i.loli.net/2021/01/29/HigjtbC35yLIAY7.png, https://i.loli.net/2021/01/29/HigjtbC35yLIAY7.png 1.5x, https://i.loli.net/2021/01/29/HigjtbC35yLIAY7.png 2x"
        data-sizes="auto"
        alt="https://i.loli.net/2021/01/29/HigjtbC35yLIAY7.png"
        title="nacos-project.png" /></p>
<h4 id="provider-服务提供者">provider 服务提供者</h4>
<h5 id="引入依赖">引入依赖</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">&lt;!-- 使用 Nacos 作为注册中心 --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;
    &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;
    &lt;version&gt;1.4.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
    &lt;artifactId&gt;dubbo-registry-nacos&lt;/artifactId&gt;
    &lt;version&gt;2.7.5&lt;/version&gt;
&lt;/dependency&gt;
<span class="c1"># 完整pom文件</span>
&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&#34;1.0&#34;</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">&#34;UTF-8&#34;</span>?&gt;
&lt;project <span class="nv">xmlns</span><span class="o">=</span><span class="s2">&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
         xmlns:xsi<span class="o">=</span><span class="s2">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
         xsi:schemaLocation<span class="o">=</span><span class="s2">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span>&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.4.2&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;user-service-provider&lt;/artifactId&gt;

    &lt;dependencies&gt;
        &lt;!-- 引入定义的 Dubbo API 接口 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;top.mikel.springboot.users&lt;/groupId&gt;
            &lt;artifactId&gt;user-service-api&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- 引入 Spring Boot 依赖 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- 实现对 Dubbo 的自动化配置 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo&lt;/artifactId&gt;
            &lt;version&gt;2.7.5&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;2.7.5&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- 使用 Zookeeper 作为注册中心 --&gt;
&lt;!--        &lt;dependency&gt;--&gt;
&lt;!--            &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;--&gt;
&lt;!--            &lt;artifactId&gt;curator-framework&lt;/artifactId&gt;--&gt;
&lt;!--            &lt;version&gt;2.13.0&lt;/version&gt;--&gt;
&lt;!--        &lt;/dependency&gt;--&gt;
&lt;!--        &lt;dependency&gt;--&gt;
&lt;!--            &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;--&gt;
&lt;!--            &lt;artifactId&gt;curator-recipes&lt;/artifactId&gt;--&gt;
&lt;!--            &lt;version&gt;2.13.0&lt;/version&gt;--&gt;
&lt;!--        &lt;/dependency&gt;--&gt;&lt;!-- 使用 Nacos 作为注册中心 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;
            &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;
            &lt;version&gt;1.4.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-registry-nacos&lt;/artifactId&gt;
            &lt;version&gt;2.7.5&lt;/version&gt;
        &lt;/dependency&gt;



    &lt;/dependencies&gt;


&lt;/project&gt;
</code></pre></td></tr></table>
</div>
</div><h5 id="修改配置文件">修改配置文件</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># dubbo 配置项，对应 DubboConfigurationProperties 配置类</span>
dubbo:
  <span class="c1"># Dubbo 应用配置</span>
  application:
    name: user-service-provider <span class="c1"># 应用名</span>
  <span class="c1"># Dubbo 注册中心配</span>
  registry:
    address: nacos://127.0.0.1:8848 <span class="c1"># 注册中心地址。个鞥多注册中心，可见 http://dubbo.apache.org/zh-cn/docs/user/references/registry/introduction.html 文档。</span>
  <span class="c1"># Dubbo 服务提供者协议配置</span>
  protocol:
    port: -1 <span class="c1"># 协议端口。使用 -1 表示随机端口。</span>
    name: dubbo <span class="c1"># 使用 `dubbo://` 协议。更多协议，可见 http://dubbo.apache.org/zh-cn/docs/user/references/protocol/introduction.html 文档</span>
  <span class="c1"># Dubbo 服务提供者配置</span>
  provider:
    timeout: <span class="m">1000</span> <span class="c1"># 【重要】远程服务调用超时时间，单位：毫秒。默认为 1000 毫秒，胖友可以根据自己业务修改</span>
    UserRpcService:
      version: 1.0.0
  <span class="c1"># 配置扫描 Dubbo 自定义的 @Service 注解，暴露成 Dubbo 服务提供者</span>
  scan:
    base-packages: top.mikel.springboot.users.service.service
</code></pre></td></tr></table>
</div>
</div><h4 id="consumer-消费者">consumer 消费者</h4>
<h5 id="引入依赖-1">引入依赖</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">&lt;!-- 使用 Nacos 作为注册中心 --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;
    &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;
    &lt;version&gt;1.4.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
    &lt;artifactId&gt;dubbo-registry-nacos&lt;/artifactId&gt;
    &lt;version&gt;2.7.5&lt;/version&gt;
&lt;/dependency&gt;
<span class="c1"># 完整pom文件</span>
&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&#34;1.0&#34;</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">&#34;UTF-8&#34;</span>?&gt;
&lt;project <span class="nv">xmlns</span><span class="o">=</span><span class="s2">&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
         xmlns:xsi<span class="o">=</span><span class="s2">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
         xsi:schemaLocation<span class="o">=</span><span class="s2">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span>&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.4.2&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;user-service-consumer&lt;/artifactId&gt;

    &lt;dependencies&gt;
        &lt;!-- 引入定义的 Dubbo API 接口 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;top.mikel.springboot.users&lt;/groupId&gt;
            &lt;artifactId&gt;user-service-api&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- 引入 Spring Boot 依赖 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- 实现对 Dubbo 的自动化配置 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo&lt;/artifactId&gt;
            &lt;version&gt;2.7.5&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;2.7.5&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- 使用 Zookeeper 作为注册中心 --&gt;
&lt;!--        &lt;dependency&gt;--&gt;
&lt;!--            &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;--&gt;
&lt;!--            &lt;artifactId&gt;curator-framework&lt;/artifactId&gt;--&gt;
&lt;!--            &lt;version&gt;2.13.0&lt;/version&gt;--&gt;
&lt;!--        &lt;/dependency&gt;--&gt;
&lt;!--        &lt;dependency&gt;--&gt;
&lt;!--            &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;--&gt;
&lt;!--            &lt;artifactId&gt;curator-recipes&lt;/artifactId&gt;--&gt;
&lt;!--            &lt;version&gt;2.13.0&lt;/version&gt;--&gt;
&lt;!--        &lt;/dependency&gt;--&gt;&lt;!-- 使用 Nacos 作为注册中心 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;
            &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;
            &lt;version&gt;1.4.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-registry-nacos&lt;/artifactId&gt;
            &lt;version&gt;2.7.5&lt;/version&gt;
        &lt;/dependency&gt;



    &lt;/dependencies&gt;


&lt;/project&gt;
</code></pre></td></tr></table>
</div>
</div><h5 id="修改配置文件-1">修改配置文件</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># dubbo 配置项，对应 DubboConfigurationProperties 配置类</span>
dubbo:
  <span class="c1"># Dubbo 应用配置</span>
  application:
    name: user-service-consumer <span class="c1"># 应用名</span>
  <span class="c1"># Dubbo 注册中心配置</span>
  registry:
    address: nacos://127.0.0.1:8848 <span class="c1"># 注册中心地址。个鞥多注册中心，可见 http://dubbo.apache.org/zh-cn/docs/user/references/registry/introduction.html 文档。</span>
  <span class="c1"># Dubbo 消费者配置</span>
  consumer:
    timeout: <span class="m">50000</span> <span class="c1"># 【重要】远程服务调用超时时间，单位：毫秒。默认为 1000 毫秒，胖友可以根据自己业务修改</span>
    UserService:
      version: 1.0.0
</code></pre></td></tr></table>
</div>
</div><h4 id="测试">测试</h4>
<ul>
<li>使用 ProviderApplication 启动服务<strong>提供者</strong>。在 Nacos 控台中，我们可以看到以 provider 为开头的服务消费者，如下图所示：</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://i.loli.net/2021/01/29/O7HTdaiuF2jUKBe.png"
        data-srcset="https://i.loli.net/2021/01/29/O7HTdaiuF2jUKBe.png, https://i.loli.net/2021/01/29/O7HTdaiuF2jUKBe.png 1.5x, https://i.loli.net/2021/01/29/O7HTdaiuF2jUKBe.png 2x"
        data-sizes="auto"
        alt="https://i.loli.net/2021/01/29/O7HTdaiuF2jUKBe.png"
        title="nacos-provider.png" /></p>
<p>服务提供者：provider</p>
<p>服务名称：top.mikel.springboot.users.service.api.UserService (包名)</p>
<p>版本号：1.0.0</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 查询注册的服务</span>
curl -sX GET <span class="s1">&#39;http://127.0.0.1:8848/nacos/v1/ns/instance/list?serviceName=providers:top.mikel.springboot.users.service.api.UserService:1.0.0:&#39;</span> <span class="p">|</span> jq
<span class="o">{</span>
  <span class="s2">&#34;hosts&#34;</span>: <span class="o">[</span>
    <span class="o">{</span>
      <span class="s2">&#34;ip&#34;</span>: <span class="s2">&#34;10.11.1.70&#34;</span>,
      <span class="s2">&#34;port&#34;</span>: 20880,
      <span class="s2">&#34;valid&#34;</span>: true,
      <span class="s2">&#34;healthy&#34;</span>: true,
      <span class="s2">&#34;marked&#34;</span>: false,
      <span class="s2">&#34;instanceId&#34;</span>: <span class="s2">&#34;10.11.1.70#20880#DEFAULT#DEFAULT_GROUP@@providers:top.mikel.springboot.users.service.api.UserService:1.0.0:&#34;</span>,
      <span class="s2">&#34;metadata&#34;</span>: <span class="o">{</span>
        <span class="s2">&#34;side&#34;</span>: <span class="s2">&#34;provider&#34;</span>,
        <span class="s2">&#34;methods&#34;</span>: <span class="s2">&#34;get&#34;</span>,
        <span class="s2">&#34;release&#34;</span>: <span class="s2">&#34;2.7.5&#34;</span>,
        <span class="s2">&#34;deprecated&#34;</span>: <span class="s2">&#34;false&#34;</span>,
        <span class="s2">&#34;dubbo&#34;</span>: <span class="s2">&#34;2.0.2&#34;</span>,
        <span class="s2">&#34;pid&#34;</span>: <span class="s2">&#34;22139&#34;</span>,
        <span class="s2">&#34;interface&#34;</span>: <span class="s2">&#34;top.mikel.springboot.users.service.api.UserService&#34;</span>,
        <span class="s2">&#34;version&#34;</span>: <span class="s2">&#34;1.0.0&#34;</span>,
        <span class="s2">&#34;generic&#34;</span>: <span class="s2">&#34;false&#34;</span>,
        <span class="s2">&#34;timeout&#34;</span>: <span class="s2">&#34;50000&#34;</span>,
        <span class="s2">&#34;revision&#34;</span>: <span class="s2">&#34;1.0.0&#34;</span>,
        <span class="s2">&#34;path&#34;</span>: <span class="s2">&#34;top.mikel.springboot.users.service.api.UserService&#34;</span>,
        <span class="s2">&#34;protocol&#34;</span>: <span class="s2">&#34;dubbo&#34;</span>,
        <span class="s2">&#34;application&#34;</span>: <span class="s2">&#34;user-service-provider&#34;</span>,
        <span class="s2">&#34;dynamic&#34;</span>: <span class="s2">&#34;true&#34;</span>,
        <span class="s2">&#34;category&#34;</span>: <span class="s2">&#34;providers&#34;</span>,
        <span class="s2">&#34;anyhost&#34;</span>: <span class="s2">&#34;true&#34;</span>,
        <span class="s2">&#34;timestamp&#34;</span>: <span class="s2">&#34;1611904293326&#34;</span>
      <span class="o">}</span>,
      <span class="s2">&#34;enabled&#34;</span>: true,
      <span class="s2">&#34;weight&#34;</span>: 1,
      <span class="s2">&#34;clusterName&#34;</span>: <span class="s2">&#34;DEFAULT&#34;</span>,
      <span class="s2">&#34;serviceName&#34;</span>: <span class="s2">&#34;providers:top.mikel.springboot.users.service.api.UserService:1.0.0:&#34;</span>,
      <span class="s2">&#34;ephemeral&#34;</span>: <span class="nb">true</span>
    <span class="o">}</span>
  <span class="o">]</span>,
  <span class="s2">&#34;dom&#34;</span>: <span class="s2">&#34;providers:top.mikel.springboot.users.service.api.UserService:1.0.0:&#34;</span>,
  <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;DEFAULT_GROUP@@providers:top.mikel.springboot.users.service.api.UserService:1.0.0:&#34;</span>,
  <span class="s2">&#34;cacheMillis&#34;</span>: 3000,
  <span class="s2">&#34;lastRefTime&#34;</span>: 1611904380175,
  <span class="s2">&#34;checksum&#34;</span>: <span class="s2">&#34;f1cecd4e4e713b97a0d5079a036971d3&#34;</span>,
  <span class="s2">&#34;useSpecifiedURL&#34;</span>: false,
  <span class="s2">&#34;clusters&#34;</span>: <span class="s2">&#34;&#34;</span>,
  <span class="s2">&#34;env&#34;</span>: <span class="s2">&#34;&#34;</span>,
  <span class="s2">&#34;metadata&#34;</span>: <span class="o">{}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://i.loli.net/2021/01/29/I2dg8TeWJkLKaUD.png"
        data-srcset="https://i.loli.net/2021/01/29/I2dg8TeWJkLKaUD.png, https://i.loli.net/2021/01/29/I2dg8TeWJkLKaUD.png 1.5x, https://i.loli.net/2021/01/29/I2dg8TeWJkLKaUD.png 2x"
        data-sizes="auto"
        alt="https://i.loli.net/2021/01/29/I2dg8TeWJkLKaUD.png"
        title="nacos-provider-info.png" /></p>
<p>可查看服务提供者详情信息，可编辑和下线操作</p>
<ul>
<li>
<p>使用 ConsumerApplication 启动服务<strong>消费者</strong>。在 Nacos 控台中，我们可以看到以 <strong><code>consumers</code></strong> 为开头的服务消费者，如下图所示：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://i.loli.net/2021/01/29/2Ikp98a1FWtBfjb.png"
        data-srcset="https://i.loli.net/2021/01/29/2Ikp98a1FWtBfjb.png, https://i.loli.net/2021/01/29/2Ikp98a1FWtBfjb.png 1.5x, https://i.loli.net/2021/01/29/2Ikp98a1FWtBfjb.png 2x"
        data-sizes="auto"
        alt="https://i.loli.net/2021/01/29/2Ikp98a1FWtBfjb.png"
        title="nacos-consumer.png" /></p>
</li>
</ul>
<p>服务消费者：consumer</p>
<p>服务名称：top.mikel.springboot.users.service.api.UserService</p>
<p>版本号：1.0.0</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">curl -sX GET <span class="s1">&#39;http://127.0.0.1:8848/nacos/v1/ns/instance/list?serviceName=consumers:top.mikel.springboot.users.service.api.UserService:1.0.0:&#39;</span> <span class="p">|</span> <span class="o">{</span>
  <span class="s2">&#34;hosts&#34;</span>: <span class="o">[</span>
    <span class="o">{</span>
      <span class="s2">&#34;ip&#34;</span>: <span class="s2">&#34;10.11.1.70&#34;</span>,
      <span class="s2">&#34;port&#34;</span>: 0,
      <span class="s2">&#34;valid&#34;</span>: true,
      <span class="s2">&#34;healthy&#34;</span>: true,
      <span class="s2">&#34;marked&#34;</span>: false,
      <span class="s2">&#34;instanceId&#34;</span>: <span class="s2">&#34;10.11.1.70#0#DEFAULT#DEFAULT_GROUP@@consumers:top.mikel.springboot.users.service.api.UserService:1.0.0:&#34;</span>,
      <span class="s2">&#34;metadata&#34;</span>: <span class="o">{</span>
        <span class="s2">&#34;init&#34;</span>: <span class="s2">&#34;false&#34;</span>,
        <span class="s2">&#34;side&#34;</span>: <span class="s2">&#34;consumer&#34;</span>,
        <span class="s2">&#34;methods&#34;</span>: <span class="s2">&#34;get&#34;</span>,
        <span class="s2">&#34;release&#34;</span>: <span class="s2">&#34;2.7.5&#34;</span>,
        <span class="s2">&#34;logger&#34;</span>: <span class="s2">&#34;slf4j&#34;</span>,
        <span class="s2">&#34;dubbo&#34;</span>: <span class="s2">&#34;2.0.2&#34;</span>,
        <span class="s2">&#34;pid&#34;</span>: <span class="s2">&#34;24431&#34;</span>,
        <span class="s2">&#34;check&#34;</span>: <span class="s2">&#34;false&#34;</span>,
        <span class="s2">&#34;interface&#34;</span>: <span class="s2">&#34;top.mikel.springboot.users.service.api.UserService&#34;</span>,
        <span class="s2">&#34;version&#34;</span>: <span class="s2">&#34;1.0.0&#34;</span>,
        <span class="s2">&#34;qos.enable&#34;</span>: <span class="s2">&#34;false&#34;</span>,
        <span class="s2">&#34;timeout&#34;</span>: <span class="s2">&#34;50000&#34;</span>,
        <span class="s2">&#34;revision&#34;</span>: <span class="s2">&#34;1.0.0&#34;</span>,
        <span class="s2">&#34;path&#34;</span>: <span class="s2">&#34;top.mikel.springboot.users.service.api.UserService&#34;</span>,
        <span class="s2">&#34;protocol&#34;</span>: <span class="s2">&#34;consumer&#34;</span>,
        <span class="s2">&#34;application&#34;</span>: <span class="s2">&#34;user-service-consumer&#34;</span>,
        <span class="s2">&#34;sticky&#34;</span>: <span class="s2">&#34;false&#34;</span>,
        <span class="s2">&#34;category&#34;</span>: <span class="s2">&#34;consumers&#34;</span>,
        <span class="s2">&#34;timestamp&#34;</span>: <span class="s2">&#34;1611909492701&#34;</span>
      <span class="o">}</span>,
      <span class="s2">&#34;enabled&#34;</span>: true,
      <span class="s2">&#34;weight&#34;</span>: 1,
      <span class="s2">&#34;clusterName&#34;</span>: <span class="s2">&#34;DEFAULT&#34;</span>,
      <span class="s2">&#34;serviceName&#34;</span>: <span class="s2">&#34;consumers:top.mikel.springboot.users.service.api.UserService:1.0.0:&#34;</span>,
      <span class="s2">&#34;ephemeral&#34;</span>: <span class="nb">true</span>
    <span class="o">}</span>
  <span class="o">]</span>,
  <span class="s2">&#34;dom&#34;</span>: <span class="s2">&#34;consumers:top.mikel.springboot.users.service.api.UserService:1.0.0:&#34;</span>,
  <span class="s2">&#34;name&#34;</span>: <span class="s2">&#34;DEFAULT_GROUP@@consumers:top.mikel.springboot.users.service.api.UserService:1.0.0:&#34;</span>,
  <span class="s2">&#34;cacheMillis&#34;</span>: 3000,
  <span class="s2">&#34;lastRefTime&#34;</span>: 1611909945384,
  <span class="s2">&#34;checksum&#34;</span>: <span class="s2">&#34;014c1cf9537cf92ce5ca74881024c6a4&#34;</span>,
  <span class="s2">&#34;useSpecifiedURL&#34;</span>: false,
  <span class="s2">&#34;clusters&#34;</span>: <span class="s2">&#34;&#34;</span>,
  <span class="s2">&#34;env&#34;</span>: <span class="s2">&#34;&#34;</span>,
  <span class="s2">&#34;metadata&#34;</span>: <span class="o">{}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://i.loli.net/2021/01/29/5PybmELG4THKWaj.png"
        data-srcset="https://i.loli.net/2021/01/29/5PybmELG4THKWaj.png, https://i.loli.net/2021/01/29/5PybmELG4THKWaj.png 1.5x, https://i.loli.net/2021/01/29/5PybmELG4THKWaj.png 2x"
        data-sizes="auto"
        alt="https://i.loli.net/2021/01/29/5PybmELG4THKWaj.png"
        title="nacos-consumer-info.png" /></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2021-02-04</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/nacos%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/index.md" target="_blank">阅读原始文档</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 WhatsApp" data-sharer="whatsapp" data-url="https://www.mikel.pan/nacos%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/" data-title="Nacos介绍及安装使用" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://www.mikel.pan/nacos%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/" data-title="Nacos介绍及安装使用" data-ralateuid="xxxx"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="分享到 百度" data-sharer="baidu" data-url="https://www.mikel.pan/nacos%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/" data-title="Nacos介绍及安装使用"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/baidu.svg"></i></a><a href="javascript:void(0);" title="分享到 Evernote" data-sharer="evernote" data-url="https://www.mikel.pan/nacos%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/" data-title="Nacos介绍及安装使用"><i class="fab fa-evernote fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/nacos/">nacos</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/jenkins%E5%AE%89%E8%A3%85/" class="prev" rel="prev" title="Jenkins安装"><i class="fas fa-angle-left fa-fw"></i>Jenkins安装</a></div>
</div>
<div id="comments"></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">mikel pan</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span><span class="icp-splitter">&nbsp;|&nbsp;</span><br class="icp-br"/>
                    <span class="icp">daadda</span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"algoliaAppID":"REQJX89W85","algoliaIndex":"index.zh-cn","algoliaSearchKey":"63fa048de9b35627f46672e95abc14df","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
